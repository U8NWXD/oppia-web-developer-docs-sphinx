<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developing new features with feature gating &mdash; Oppia Web Contributor Documentation  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lint Checks" href="lint.html" />
    <link rel="prev" title="Launching new features" href="Launching-new-features.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Oppia Web Contributor Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Oppia%27s-Mission.html">Oppia’s Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oppia%27s-Mission.html#vision">Vision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/oppia/oppia/blob/develop/.github/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-involved.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing Oppia</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Frequently-Asked-Questions.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing-Oppia.html">Installing Oppia</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tips-for-common-IDEs.html">Tips for common IDEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Make-a-pull-request.html">Make a pull request</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pull-requests-at-Oppia.html">Pull requests at Oppia</a></li>
<li class="toctree-l1"><a class="reference internal" href="Get-help.html">Get help</a></li>
<li class="toctree-l1"><a class="reference internal" href="Learning-Resources.html">Learning resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Git-cheat-sheet.html">Git cheat sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Get started with the code base</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="coding-guidelines.html">Coding guidelines</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Coding-style-guide.html">Coding style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="The-File-Naming-Convention-and-Directory-Structure.html">Guidelines for creating new files</a></li>
<li class="toctree-l2"><a class="reference internal" href="Adding-new-page.html">How to add a new page</a></li>
<li class="toctree-l2"><a class="reference internal" href="Guide-on-defining-types.html">How to write type definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Writing-design-docs.html">Writing design docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="Revert-and-Regression-Policy.html">Revert and regression policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="Launching-new-features.html">Launching new features</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Feature Gating</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#follow-the-steps-below-to-add-a-new-feature-flag">Follow the steps below to add a new feature flag</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feature-stage-explanation">Feature Stage Explanation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-example">Usage Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gating-in-backend">Gating in Backend</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gating-in-frontend">Gating in Frontend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#changing-value-of-feature-flags">Changing Value of Feature Flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#settings-of-feature-flags">Settings of Feature Flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lint.html">Lint Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="Oppia%27s-code-owners-and-checks-to-be-carried-out-by-developers.html">Oppia’s code owners and checks to be carried out by developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="Oppia%27s-code-owners-and-checks-to-be-carried-out-by-developers.html#temporary-codeowner-transfer-process">Temporary codeowner transfer process</a></li>
<li class="toctree-l2"><a class="reference internal" href="Privacy-aware-programming.html">Privacy aware programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Privacy-aware-programming.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Privacy-aware-programming.html#design-stage">Design stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="Privacy-aware-programming.html#implementation-stage">Implementation stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="Backend-Type-Annotations.html">Backend type annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bytes-and-string-handling-in-Python-3.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bytes-and-string-handling-in-Python-3.html#rules-for-handling-strings-and-bytes">Rules for handling strings and bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="Guidelines-for-Developers-with-Write-Access-to-oppia-oppia.html">Guidelines for developers with write access to Oppia Oppia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Events-Team.html">Oppia Events team</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Oppiabot.html">Oppiabot</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend-reference.html">Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend-reference.html">Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="Adding-new-translations-for-i18n.html">Adding new translations for i18n</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-develop-for-i18n.html">How to develop for i18n</a></li>
<li class="toctree-l1"><a class="reference internal" href="Webpack.html">Webpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension-reference.html">Extension frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Advice-on-creating-explorations.html">Advice on creating explorations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oppia-ml-Extension.html">Oppia-ml Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mobile-development.html">Mobile development</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mobile-device-testing.html">Mobile device testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance-Testing.html">Performance testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build-process.html">Build process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Team-Structure.html">Team structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="past-events.html">Past Events</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Oppia Web Contributor Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="coding-guidelines.html">Coding guidelines</a> &raquo;</li>
      <li>Developing new features with feature gating</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Developing-new-features-with-feature-gating.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="developing-new-features-with-feature-gating">
<h1>Developing new features with feature gating<a class="headerlink" href="#developing-new-features-with-feature-gating" title="Permalink to this headline"></a></h1>
<p>If you are developing a new feature that hasn’t been in a stable state, you may want to limit the scope of the feature so that it’s only enabled when certain criteria is met (e.g. only enabled in dev environment). In these cases you can use the dynamic feature gating system to gate the enabling of the features with a feature flag.</p>
<p>If you have any question regarding the feature gating system, feel free to contact &#64;MegrezZhu.</p>
<section id="follow-the-steps-below-to-add-a-new-feature-flag">
<h2>Follow the steps below to add a new feature flag<a class="headerlink" href="#follow-the-steps-below-to-add-a-new-feature-flag" title="Permalink to this headline"></a></h2>
<ol class="simple">
<li><p>Add a unique feature flag name in the <code class="docutils literal notranslate"><span class="pre">PARAM_NAMES</span></code> enum in <code class="docutils literal notranslate"><span class="pre">core/domain/platform_parameter_list.py</span></code>. Example:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PARAM_NAMES</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_enum</span><span class="p">(</span>
    <span class="c1"># ... existing names</span>
    <span class="s1">&#39;new_feature&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Create a feature flag instance in the same file with its name, description and stage (see the <a class="reference external" href="#Feature-stage">Feature Stage</a> section for detail). Example:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Registry</span><span class="o">.</span><span class="n">create_feature_flag</span><span class="p">(</span>
    <span class="n">PARAM_NAMES</span><span class="o">.</span><span class="n">new_feature</span><span class="p">,</span>
    <span class="s1">&#39;This is a newly created feature.&#39;</span><span class="p">,</span>
    <span class="n">FEATURE_STAGES</span><span class="o">.</span><span class="n">dev</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Add the name of the newly created feature to one of the feature name lists (<code class="docutils literal notranslate"><span class="pre">DEV_FEATURES_LIST</span></code>, <code class="docutils literal notranslate"><span class="pre">TEST_FEATURES_LIST</span></code>, or <code class="docutils literal notranslate"><span class="pre">PROD_FEATURES_LIST</span></code>) in <code class="docutils literal notranslate"><span class="pre">core/platform_feature_list.py</span></code> according to its stage. Note: if the name is added to the wrong list, a backend test error will raise. Example:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DEV_FEATURES_LIST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">params</span><span class="o">.</span><span class="n">PARAM_NAMES</span><span class="o">.</span><span class="n">new_feature</span>
<span class="p">]</span>
</pre></div>
</div>
<ol class="simple">
<li><p>To make the feature flag available in the front-end, you need to add it into the name enum in <code class="docutils literal notranslate"><span class="pre">core/templates/domain/platform_feature/feature-status-summary.model.ts</span></code> as well:</p></li>
</ol>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">enum</span> <span class="nx">FeatureNames</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">NewFeature</span> <span class="o">=</span> <span class="s1">&#39;new_feature&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="feature-stage-explanation">
<h2>Feature Stage Explanation<a class="headerlink" href="#feature-stage-explanation" title="Permalink to this headline"></a></h2>
<p>Features fall in the three types of stages: dev, test and prod. In short, the stage of a feature implies its maturity &amp; stability and the environment where it can be enabled:</p>
<ul class="simple">
<li><p>dev feature can only be enabled in dev environment.</p></li>
<li><p>test feature can be enabled in dev or test environments, but it can never be enabled in production environments.</p></li>
<li><p>prod feature can be enabled in any of the dev, test, production environments.</p></li>
</ul>
</section>
<section id="usage-example">
<h2>Usage Example<a class="headerlink" href="#usage-example" title="Permalink to this headline"></a></h2>
<section id="gating-in-backend">
<h3>Gating in Backend<a class="headerlink" href="#gating-in-backend" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">platform_feature_list</span>
<span class="kn">from</span> <span class="nn">core.domain</span> <span class="kn">import</span> <span class="n">platform_feature_services</span>

<span class="c1"># ...</span>

<span class="k">if</span> <span class="n">platform_feature_services</span><span class="o">.</span><span class="n">is_feature_enabled</span><span class="p">(</span>
    	<span class="n">platform_feature_list</span><span class="o">.</span><span class="n">PARAM_NAMES</span><span class="o">.</span><span class="n">dummy_feature</span><span class="p">):</span>
    <span class="c1"># Code of the feature</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not implemented.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="gating-in-frontend">
<h2>Gating in Frontend<a class="headerlink" href="#gating-in-frontend" title="Permalink to this headline"></a></h2>
<p>The status of features is loaded during the page initialization, once it’s loaded you can access it through the <code class="docutils literal notranslate"><span class="pre">PlatformFeatureService</span></code>:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Assuming this.featureService is the PlatformFeatureService instance.</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">featureService</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">NewFeature</span><span class="p">.</span><span class="nx">isEnabled</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Code of the feature</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="changing-value-of-feature-flags">
<h3>Changing Value of Feature Flags<a class="headerlink" href="#changing-value-of-feature-flags" title="Permalink to this headline"></a></h3>
<p>Feature flags are defaulted to <code class="docutils literal notranslate"><span class="pre">false/disabled</span></code>, to change its value, you can login as the administrator, navigate to the admin page, then to the feature tab.</p>
<p>In the feature tab, where you will see the feature flag you added, you can change the settings (see the <a class="reference external" href="#settings-of-feature-flags">Setting of Feature Flags</a> section for detail) of the feature flags.</p>
<p>Note: since only users with admin permission can edit the settings of feature flags, you can only enable your features on your local dev instance of Oppia, while in production environment, only administrators can enable/disable features.</p>
</section>
</section>
<section id="settings-of-feature-flags">
<h2>Settings of Feature Flags<a class="headerlink" href="#settings-of-feature-flags" title="Permalink to this headline"></a></h2>
<p>We use the following principles to determine the value of a feature flags:</p>
<ul class="simple">
<li><p>Each feature flag has multiple <em>rules</em>, its value changes to the value specified in the first rule that is matched. If no rule is matched, its value remains default.</p></li>
<li><p>Each rule has multiple <em>filters</em>, and a rule is matched only when all of its filters are matched.</p></li>
<li><p>Each filter describes a scenario, there are multiple types of filters like <code class="docutils literal notranslate"><span class="pre">server</span> <span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">client</span> <span class="pre">type</span></code>, so that you can you can describe scenarios like <code class="docutils literal notranslate"><span class="pre">server</span> <span class="pre">mode</span> <span class="pre">=</span> <span class="pre">dev</span> <span class="pre">OR</span> <span class="pre">server</span> <span class="pre">mode</span> <span class="pre">=</span> <span class="pre">test</span></code>.</p></li>
<li><p>Each filter can have multiple conditions, and a filter is matched if any of the conditions are matched.</p></li>
</ul>
<p>For example, if we want to make a feature flag to be enable only in dev environments, we can set the feature flag as the image below.</p>
<p><img alt="Example feature setting" src="https://i.imgur.com/GnFQ7El.jpg" /></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Launching-new-features.html" class="btn btn-neutral float-left" title="Launching new features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lint.html" class="btn btn-neutral float-right" title="Lint Checks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The Oppia Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>