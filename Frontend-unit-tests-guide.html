<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frontend unit tests guide &mdash; Oppia Web Contributor Documentation  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="End to end tests" href="End-to-End-Tests.html" />
    <link rel="prev" title="Backend tests" href="Backend-tests.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Oppia Web Contributor Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Oppia%27s-Mission.html">Oppia’s Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oppia%27s-Mission.html#vision">Vision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/oppia/oppia/blob/develop/.github/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-involved.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing Oppia</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Frequently-Asked-Questions.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing-Oppia.html">Installing Oppia</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tips-for-common-IDEs.html">Tips for common IDEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Make-a-pull-request.html">Make a pull request</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pull-requests-at-Oppia.html">Pull requests at Oppia</a></li>
<li class="toctree-l1"><a class="reference internal" href="Get-help.html">Get help</a></li>
<li class="toctree-l1"><a class="reference internal" href="Learning-Resources.html">Learning resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Git-cheat-sheet.html">Git cheat sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Get started with the code base</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding-guidelines.html">Coding guidelines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="testing.html">Testing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Running-Tests.html">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Backend-tests.html">Backend tests</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Frontend unit tests guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#goal">Goal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-coverage">Code coverage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#helpful-resources">Helpful resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-frontend-tests">Run frontend tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#coverage-reports">Coverage reports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#write-frontend-tests">Write frontend tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#unit-test-structure">Unit test structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#good-practices">Good practices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#general-tips">General tips</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spy-utilities">Spy utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-dates">Handling dates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-asynchronous-code">Handling asynchronous code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#when-upgraded-services-should-be-imported-in-the-test-file">When upgraded services should be imported in the test file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#beforeeach-calls-in-angularjs"><code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> calls in AngularJS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-handle-common-errors">How to handle common errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing-services">Testing services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing-angularjs-services">Testing AngularJS services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-angular-2-services">Testing Angular 2+ services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing-controllers">Testing controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-directives-and-components">Testing directives and components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing-angularjs-directives-and-components">Testing AngularJS directives and components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-angular2-directives-and-components">Testing Angular2+ directives and components</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#contacts">Contacts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="End-to-End-Tests.html">End to end tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Lighthouse-Tests.html">Lighthouse CI Automated Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Lighthouse-Tests.html#how-to-add-new-pages-to-lighthouse-tests">How to add new pages to lighthouse tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Lighthouse-Tests.html#debugging-lighthouse-tests">Debugging Lighthouse Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing-for-Accessibility.html">General Good Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing-for-Accessibility.html#visual-disabilities">Visual Disabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing-for-Accessibility.html#physical-disabilities">Physical Disabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing-for-Accessibility.html#hearing-disabilities">Hearing Disabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="Release-accessibility-checklist.html">Accessibility Manual Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Events-Team.html">Oppia Events team</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Oppiabot.html">Oppiabot</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend-reference.html">Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend-reference.html">Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="Adding-new-translations-for-i18n.html">Adding new translations for i18n</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-develop-for-i18n.html">How to develop for i18n</a></li>
<li class="toctree-l1"><a class="reference internal" href="Webpack.html">Webpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension-reference.html">Extension frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Advice-on-creating-explorations.html">Advice on creating explorations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Oppia-ml-Extension.html">Oppia-ml Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mobile-development.html">Mobile development</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mobile-device-testing.html">Mobile device testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance-Testing.html">Performance testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build-process.html">Build process</a></li>
<li class="toctree-l1"><a class="reference internal" href="Team-Structure.html">Team structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="past-events.html">Past Events</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Oppia Web Contributor Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="testing.html">Testing</a> &raquo;</li>
      <li>Frontend unit tests guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Frontend-unit-tests-guide.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="frontend-unit-tests-guide">
<h1>Frontend unit tests guide<a class="headerlink" href="#frontend-unit-tests-guide" title="Permalink to this headline"></a></h1>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#introduction">Introduction</a></p>
<ul>
<li><p><a class="reference external" href="#goal">Goal</a></p></li>
<li><p><a class="reference external" href="#unit-tests">Unit tests</a></p></li>
<li><p><a class="reference external" href="#code-coverage">Code coverage</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#helpful-resources">Helpful resources</a></p></li>
<li><p><a class="reference external" href="#run-frontend-tests">Run frontend tests</a></p>
<ul>
<li><p><a class="reference external" href="#coverage-reports">Coverage reports</a></p>
<ul>
<li><p><a class="reference external" href="#reading-a-coverage-report">Reading a coverage report</a></p></li>
<li><p><a class="reference external" href="#ensuring-that-coverage-is-maintained">Ensuring that coverage is maintained</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#write-frontend-tests">Write frontend tests</a></p>
<ul>
<li><p><a class="reference external" href="#unit-test-structure">Unit test structure</a></p>
<ul>
<li><p><a class="reference external" href="#describe"><code class="docutils literal notranslate"><span class="pre">describe</span></code></a></p></li>
<li><p><a class="reference external" href="#beforeeach"><code class="docutils literal notranslate"><span class="pre">beforeEach</span></code></a></p></li>
<li><p><a class="reference external" href="#it"><code class="docutils literal notranslate"><span class="pre">it</span></code></a></p></li>
<li><p><a class="reference external" href="#aftereach"><code class="docutils literal notranslate"><span class="pre">afterEach</span></code></a></p></li>
<li><p><a class="reference external" href="#afterall"><code class="docutils literal notranslate"><span class="pre">afterAll</span></code></a></p></li>
<li><p><a class="reference external" href="#expect"><code class="docutils literal notranslate"><span class="pre">expect</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#good-practices">Good practices</a></p>
<ul>
<li><p><a class="reference external" href="#tests-should-work-in-any-order">Tests should work in any order</a></p></li>
<li><p><a class="reference external" href="#do-not-test-private-methodsproperties">Do not test private methods/properties</a></p></li>
<li><p><a class="reference external" href="#worry-about-behavior-and-not-about-coverage">Worry about behavior and not about coverage</a></p></li>
<li><p><a class="reference external" href="#name-variables-clearly">Name variables clearly</a></p></li>
<li><p><a class="reference external" href="#name-tests-clearly">Name tests clearly</a></p></li>
<li><p><a class="reference external" href="#check-return-values-from-the-code-being-tested">Check return values from the code being tested</a></p></li>
<li><p><a class="reference external" href="#test-the-interface-not-the-implementation">Test the interface, not the implementation</a></p></li>
<li><p><a class="reference external" href="#keep-tests-clean-and-clear">Keep tests clean and clear</a></p></li>
<li><p><a class="reference external" href="#similar-tests-should-have-similar-checks">Similar tests should have similar checks</a></p></li>
<li><p><a class="reference external" href="#validate-external-side-effects">Validate external side-effects</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#general-tips">General tips</a></p>
<ul>
<li><p><a class="reference external" href="#debugging">Debugging</a></p></li>
<li><p><a class="reference external" href="#spy-utilities">Spy utilities</a></p>
<ul>
<li><p><a class="reference external" href="#spying-on-third-party-libraries">Spying on third-party libraries</a></p></li>
<li><p><a class="reference external" href="#spying-on-the-same-methodproperty-more-than-one-time-in-the-same-scope">Spying on the same method/property more than one time in the same scope</a></p></li>
<li><p><a class="reference external" href="#spies-that-change-global-values">Spies that change global values</a></p></li>
<li><p><a class="reference external" href="#handling-window-events-and-reloads">Handling window events and reloads</a></p>
<ul>
<li><p><a class="reference external" href="#when-window-calls-reload">When window calls reload</a></p></li>
<li><p><a class="reference external" href="#using-the-same-object-reference-in-both-file-and-spec-file">Using the same object reference in both file and spec file</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#handling-dates">Handling dates</a></p></li>
<li><p><a class="reference external" href="#handling-asynchronous-code">Handling asynchronous code</a></p>
<ul>
<li><p><a class="reference external" href="#making-http-calls">Making HTTP calls</a></p>
<ul>
<li><p><a class="reference external" href="#setting-up-csrftoken">Setting up CsrfToken</a></p></li>
<li><p><a class="reference external" href="#http-calls-in-angularjs">HTTP calls in AngularJS</a></p></li>
<li><p><a class="reference external" href="#http-calls-in-angular-2">HTTP calls in Angular 2+</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#using-done-and-donefail-from-jasmine">Using <code class="docutils literal notranslate"><span class="pre">done</span></code> and <code class="docutils literal notranslate"><span class="pre">done.fail</span></code> from Jasmine</a></p></li>
<li><p><a class="reference external" href="#handling-timeout-correctly">Handling <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> correctly</a></p></li>
<li><p><a class="reference external" href="#mocking-with-q-api-in-angularjs">Mocking with <code class="docutils literal notranslate"><span class="pre">$q</span></code> API in AngularJS</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#when-upgraded-services-should-be-imported-in-the-test-file">When upgraded services should be imported in the test file</a></p></li>
<li><p><a class="reference external" href="#beforeeach-calls-in-angularjs"><code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> calls in AngularJS</a></p></li>
<li><p><a class="reference external" href="#how-to-handle-common-errors">How to handle common errors</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#testing-services">Testing services</a></p>
<ul>
<li><p><a class="reference external" href="#testing-angularjs-services">Testing AngularJS services</a></p></li>
<li><p><a class="reference external" href="#testing-angular-2-services">Testing Angular 2+ services</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#testing-controllers">Testing controllers</a></p></li>
<li><p><a class="reference external" href="#testing-directives-and-components">Testing directives and components</a></p>
<ul>
<li><p><a class="reference external" href="#testing-angularjs-directives-and-components">Testing AngularJS directives and components</a></p></li>
<li><p><a class="reference external" href="#testing-angular2-directives-and-components">Testing Angular2+ directives and components</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#contacts">Contacts</a></p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<section id="goal">
<h3>Goal<a class="headerlink" href="#goal" title="Permalink to this headline"></a></h3>
<p>Our goal is for every file with frontend code to be thoroughly tested by its associated test file. For example, <code class="docutils literal notranslate"><span class="pre">user.service.ts</span></code> should be comprehensively tested by <code class="docutils literal notranslate"><span class="pre">user.service.spec.ts</span></code>. By “comprehensively,” we mean that the tests should cover all possible ways the code in <code class="docutils literal notranslate"><span class="pre">user.service.ts</span></code> might be used. It’s especially important for test to cover both happy (expected) and unhappy (unexpected) usages. <a class="reference external" href="https://github.com/oppia/oppia/blob/ae649aa08f/core/templates/services/questions-list.service.spec.ts#L19">Here</a> is a good example of a comprehensive set of test cases.</p>
</section>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline"></a></h3>
<p>A unit test checks the behavior of small pieces of code, which are called units. Often, the unit is a funtion, in which case the behavior being tested would be the function’s outputs given some inputs.</p>
<p>A unit test should depend only on the “external” behavior to be tested, not the specific implementation of the function. This means that the behavior of other units is out of scope.
<a class="reference external" href="https://github.com/oppia/oppia/blob/ae649aa08f1375457ec9e3c90257197b68fec7cd/core/templates/domain/skill/RubricObjectFactorySpec.ts#L28-L41">Here</a> is a simple unit test that demonstrates these points.</p>
</section>
<section id="code-coverage">
<h3>Code coverage<a class="headerlink" href="#code-coverage" title="Permalink to this headline"></a></h3>
<p>We get a rough idea of how comprehensive our tests are by measuring <em>code coverage</em>, which is the fraction of testable lines of code that were executed when the tests were run. For example, consider the following pseudocode:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1 # Compute the absolute value of a number
2 function absoluteValue(number) {
3   if number &lt;= 0 {
4     return -number
5   } else {
6     return number
7   }
8 }
</pre></div>
</div>
<p>Now consider the following sets of test cases:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">absoluteValue(1)</span></code> and <code class="docutils literal notranslate"><span class="pre">absoluteValue(5)</span></code>: These test cases are not comprehensive because they only test positive numbers. Code coverage is also not 100% because line 4 is never executed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">absoluteValue(0)</span></code> and <code class="docutils literal notranslate"><span class="pre">absoluteValue(1)</span></code>: These test cases are not comprehensive because they do not test negative numbers, and it’s important for an absolute value function to correctly handle negative inputs. However, the code coverage is 100% because both blocks of the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement are executed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">absoluteValue(-1)</span></code>, <code class="docutils literal notranslate"><span class="pre">absoluteValue(0)</span></code>, and <code class="docutils literal notranslate"><span class="pre">absoluteValue(1)</span></code>: These test cases are comprehensive, and code coverage is 100%. Note that even though line 1 doesn’t execute, coverage is 100% because line 1 is not executable.</p></li>
</ul>
<p>This example illustrates something very important about code coverage: <strong>Code coverage less than 100% implies that the tests are not comprehensive, but code coverage of 100% does not imply that tests are comprehensive.</strong> Therefore, while code coverage is a useful tool, you should primarily think about whether your tests cover all the possible behaviors of the code being tested. In other words, you should have a behavior-first perspective. Don’t just think about which lines are covered.</p>
<p>When we achieve our goal, then for every frontend code file, executing only its associated test file should result in 100% coverage of the code file. Note that to execute only a single test file, you can change <code class="docutils literal notranslate"><span class="pre">describe</span></code>s in that file to <code class="docutils literal notranslate"><span class="pre">fdescribe</span></code>s.</p>
</section>
</section>
<section id="helpful-resources">
<h2>Helpful resources<a class="headerlink" href="#helpful-resources" title="Permalink to this headline"></a></h2>
<p>This list contains some resources that might help you while writing unit tests:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jasmine.github.io/api/edge/global">Jasmine documentation</a></p></li>
<li><p><a class="reference external" href="https://karma-runner.github.io/">Karma</a></p></li>
<li><p><a class="reference external" href="https://angular.io/guide/testing">Angular 2+ testing</a></p></li>
<li><p><a class="reference external" href="https://docs.angularjs.org/guide/unit-testing">AngularJS testing</a></p></li>
</ul>
</section>
<section id="run-frontend-tests">
<h2>Run frontend tests<a class="headerlink" href="#run-frontend-tests" title="Permalink to this headline"></a></h2>
<p>Running the frontend tests is as simple as running this command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -m scripts.run_frontend_tests</span>
</pre></div>
</div>
<p>These tests also run whenever you push changes to the frontend code.</p>
<section id="coverage-reports">
<h3>Coverage reports<a class="headerlink" href="#coverage-reports" title="Permalink to this headline"></a></h3>
<p>Coverage reports are an indispensable tool when working with unit tests. They can show you which lines are being tested and which are not. Use these reports to help you write better tests and to ensure that all the files and functionality are totally covered by the tests you write.</p>
<p>Whenever you run the frontend tests, a coverage report will be generated at the <code class="docutils literal notranslate"><span class="pre">oppia/../karma_coverage_reports/index.html</span></code>.  The report will look like this:</p>
<p><img alt="Karma Coverage reports" src="https://user-images.githubusercontent.com/34922478/80640321-9e30f900-8a39-11ea-8b8e-98dab4a3d48b.png" /></p>
<section id="reading-a-coverage-report">
<h4>Reading a coverage report<a class="headerlink" href="#reading-a-coverage-report" title="Permalink to this headline"></a></h4>
<p>When writing tests, the goal is to completely cover the file. In order to do that, you need to understand what the coverage report is telling you. Basically, the report tells you which line is being hit, partially hit, or missed:</p>
<ul class="simple">
<li><p><strong>Hit</strong>: the line was executed by the test suite.</p></li>
<li><p><strong>Partially hit</strong>: the line was partially executed by the test suite. There’s another possibility where this line is missed.</p></li>
<li><p><strong>Missed</strong>: the line wasn’t executed by the test suite.</p></li>
</ul>
<p>More than just reporting the “covered” state of each line, the coverage report also reports something called <strong>branch coverage</strong>. A branch refers to a branch in the program (if/else statements, loops, and so on). To be fully covered, all the file’s branches need to be tested. The Karma coverage report uses symbols (with letter I - for if - and E - for else) to refer to if/else statements branches. It’s important to note that these symbols will appear even if the branch is being covered, so please <strong>ignore</strong> these symbols and pay attention to only the line coverage information (as you see above). Here’s an example:</p>
<p><img alt="Example for branch coverage symbols" src="https://user-images.githubusercontent.com/34922478/80809691-9340aa80-8b98-11ea-9a22-6fd21171db85.png" /></p>
</section>
<section id="ensuring-that-coverage-is-maintained">
<h4>Ensuring that coverage is maintained<a class="headerlink" href="#ensuring-that-coverage-is-maintained" title="Permalink to this headline"></a></h4>
<p>In order to make the coverage stable, by default we require that every frontend file is fully covered. Since we are still increasing frontend coverage, there are some exceptions to this rule. Files that are not fully covered are listed in <code class="docutils literal notranslate"><span class="pre">scripts/check_frontend_coverage.py</span></code>.</p>
<p>If you pass the <code class="docutils literal notranslate"><span class="pre">--check_coverage</span></code> flag when running the tests, then the tests will check whether all expected files are fully covered. The output looks like this:</p>
<p><img alt="Example of output by tracking the changes in the frontend unit tests" src="https://user-images.githubusercontent.com/34922478/80845732-8182f580-8be0-11ea-9c47-0f46f1f44c2f.png" /></p>
</section>
</section>
</section>
<section id="write-frontend-tests">
<h2>Write frontend tests<a class="headerlink" href="#write-frontend-tests" title="Permalink to this headline"></a></h2>
<section id="unit-test-structure">
<h3>Unit test structure<a class="headerlink" href="#unit-test-structure" title="Permalink to this headline"></a></h3>
<p>A unit test is made of functions that configure the test environment, make assertions, and separate the different contexts of each situation. There are some test functions that are used across the codebase:</p>
<section id="describe">
<h4><code class="docutils literal notranslate"><span class="pre">describe</span></code><a class="headerlink" href="#describe" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">describe</span></code> function has a string parameter which should contain the name of the component being tested or (when nested within another <code class="docutils literal notranslate"><span class="pre">describe</span></code> function) should describe the conditions imposed on the specific context pertaining to the tests in that <code class="docutils literal notranslate"><span class="pre">describe</span></code> block. Here are some examples:</p>
<ul>
<li><p>An outer <code class="docutils literal notranslate"><span class="pre">describe</span></code> function:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Component Name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
<li><p>Two <code class="docutils literal notranslate"><span class="pre">describe</span></code> functions nested inside another <code class="docutils literal notranslate"><span class="pre">describe</span></code> function:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Component Name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;when it is available&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{...});</span>

  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;when it is not available&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{...});</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<p>Check out <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/creator-dashboard-page/suggestion-modal-for-creator-view/suggestion-modal-for-creator-view.controller.spec.ts#L24-L310">a real example</a> in the codebase to see how to use <code class="docutils literal notranslate"><span class="pre">describe</span></code> properly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">describe</span></code> function also has some variants to help you. Use these variants only on your local machine for testing.</p>
<ul class="simple">
<li><p><strong>fdescribe</strong>: This is used when you want to run only the test suite marked as <code class="docutils literal notranslate"><span class="pre">fdescribe</span></code>.</p></li>
<li><p><strong>xdescribe</strong>: This is used when you want to run all test suites except the one marked with <code class="docutils literal notranslate"><span class="pre">xdescribe</span></code>.</p></li>
</ul>
</section>
<section id="beforeeach">
<h4><code class="docutils literal notranslate"><span class="pre">beforeEach</span></code><a class="headerlink" href="#beforeeach" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> function is used to set up essential configurations and variables before each test runs. This function is mostly used for three things:</p>
<ul>
<li><p>Injecting the modules to be tested or to be used as helpers inside the test file. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/splash-page/splash-page.controller.spec.ts#L37-L49">Here</a> is an example.</p></li>
<li><p>Mocking the unit test’s external dependencies (only on AngularJS files):</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;ExplorationStatesService&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">getState</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">interaction</span><span class="o">:</span> <span class="kc">null</span> <span class="p">})</span>
  <span class="p">});</span>
<span class="p">}));</span>
</pre></div>
</div>
</li>
<li><p>Providing Angular2+ services in downgrade files when the AngularJS service being tested uses any upgraded (Angular2+) service as a dependency. For example, assume that the test requires MyExampleService which is an Angular2+ service:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">TestBed</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core/testing&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MyExampleService</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;services/my-example.service&#39;</span><span class="p">;</span>
<span class="p">...</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
    <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">HttpClientTestingModule</span><span class="p">]</span>
  <span class="p">});</span>
<span class="p">});</span>
<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;oppia&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;MyExampleService&#39;</span><span class="p">,</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">MyExampleService</span><span class="p">));</span>
<span class="p">}));</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="it">
<h4><code class="docutils literal notranslate"><span class="pre">it</span></code><a class="headerlink" href="#it" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">it</span></code> function is where the test happens. Like the <code class="docutils literal notranslate"><span class="pre">describe</span></code> function, its first parameter is a string which should determine the action to be tested and the expected outcome of the tests. The string should have a clear description of what is going to be tested. Also, <strong>the string must start with “should”</strong>.</p>
<p>All possible code paths in the function should be tested. See this <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/search.service.spec.ts#L82-L451">example in codebase</a> and notice how the test names give you an idea of what is expected.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">describe</span></code>, the <code class="docutils literal notranslate"><span class="pre">it</span></code> function has the variants <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">xit</span></code> and they can be used in the same way as <code class="docutils literal notranslate"><span class="pre">fdescribe</span></code> and <code class="docutils literal notranslate"><span class="pre">xdescribe</span></code>.</p>
</section>
<section id="aftereach">
<h4><code class="docutils literal notranslate"><span class="pre">afterEach</span></code><a class="headerlink" href="#aftereach" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">afterEach</span></code> function runs after each test, and it is not used often. It’s mostly used when we are handling async features such as HTTP and timeout calls (both in AngularJS and Angular 2+). <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/domain/exploration/read-only-exploration-backend-api.service.spec.ts#L100-L103">Here</a>’s an example to handle HTTP mocks in AngularJS and <a class="reference external" href="https://github.com/oppia/oppia/blob/ae649aa08f/core/templates/domain/classroom/classroom-backend-api.service.spec.ts#L72-L74">here</a>’s an example of doing the same in Angular 2+.</p>
</section>
<section id="afterall">
<h4><code class="docutils literal notranslate"><span class="pre">afterAll</span></code><a class="headerlink" href="#afterall" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">afterAll</span></code> function runs after all the tests have finished, but it is almost never used in the codebase. There is a specific case which it might be very helpful: when a global variable needs to be reassigned during the tests, you need to reset it to the default value after all the assertions are finished. Check an example of this case <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/site-analytics.service.spec.ts#L40-L42">here</a>.</p>
</section>
<section id="expect">
<h4><code class="docutils literal notranslate"><span class="pre">expect</span></code><a class="headerlink" href="#expect" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">expect</span></code> function is used to assert a condition in the test. You can check all its methods in the <a class="reference external" href="https://jasmine.github.io/api/edge/matchers.html">Jasmine documentation</a>. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/services/graph-data.service.spec.ts#L92-L112">Here’s</a> a good example of how to use it correctly.</p>
</section>
</section>
<section id="good-practices">
<h3>Good practices<a class="headerlink" href="#good-practices" title="Permalink to this headline"></a></h3>
<section id="tests-should-work-in-any-order">
<h4>Tests should work in any order<a class="headerlink" href="#tests-should-work-in-any-order" title="Permalink to this headline"></a></h4>
<p>It is possible to write frontend tests that only pass when run in a particular order. Here’s an example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;oppia&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="mf">2</span><span class="p">;</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should do something&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">test</span> <span class="o">=</span> <span class="mf">3</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should do something else&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">test</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This test will pass when <code class="docutils literal notranslate"><span class="pre">should</span> <span class="pre">do</span> <span class="pre">something</span> <span class="pre">else</span></code> runs before <code class="docutils literal notranslate"><span class="pre">should</span> <span class="pre">do</span> <span class="pre">something</span></code>, but not when the tests run in the opposite order. This is bad! Since Karma runs tests in a non-deterministic order, you should never assume that tests will run in a particular order.</p>
</section>
<section id="do-not-test-private-methods-properties">
<h4>Do not test private methods/properties<a class="headerlink" href="#do-not-test-private-methods-properties" title="Permalink to this headline"></a></h4>
<p>Private methods/properties should only be accessed just by the class or function where they are defined. Their names start with <code class="docutils literal notranslate"><span class="pre">_</span></code>. It’s not a good practice to test private methods/properties because they should not be accessed from the outside. Instead, you should only test public methods and their output. For example:</p>
<ul>
<li><p>Bad:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should get generic name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">_name</span><span class="p">;</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
<li><p>Good:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should get generic name&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="worry-about-behavior-and-not-about-coverage">
<h4>Worry about behavior and not about coverage<a class="headerlink" href="#worry-about-behavior-and-not-about-coverage" title="Permalink to this headline"></a></h4>
<p>Make sure your tests check the file’s behavior, not just that they get to 100% coverage. Unit tests are about testing the expected output, not the internal implementation. For example:</p>
<ul>
<li><p>Bad:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>it(&#39;should get items from api&#39;, function() {
  var consoleSpy = spyOn(console, &#39;log&#39;).and.callThrough();
  component.fetchApi();
  expect(consoleSpy).haveBeenCalledWith(&#39;fetched!);
});
</pre></div>
</div>
</li>
<li><p>Good:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should get items from api&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">MAX_ITEMS_TO_FETCH</span> <span class="o">=</span> <span class="mf">10</span><span class="p">;</span>
  <span class="nx">component</span><span class="p">.</span><span class="nx">fetchApi</span><span class="p">();</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">itemsFetched</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="name-variables-clearly">
<h4>Name variables clearly<a class="headerlink" href="#name-variables-clearly" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>Expected variables must be named so that it’s clear that they store expected data.</p>
<ul>
<li><p><strong>Example</strong>: ‘expectedAdjacencyList’, ‘expectedNodeData’.</p></li>
</ul>
</li>
<li><p>Variables storing return values must have names that suggest that they have been returned.</p>
<ul>
<li><p><strong>Example</strong>: ‘returnedNodeData’, ‘returnedGraphHeight’.</p></li>
</ul>
</li>
<li><p>For variables that have a unit, mention the unit in the variable name.</p>
<ul>
<li><p><strong>Example</strong>: ‘graphHeightInPixels’, ‘graphHeightInCm’</p></li>
</ul>
</li>
</ul>
</section>
<section id="name-tests-clearly">
<h4>Name tests clearly<a class="headerlink" href="#name-tests-clearly" title="Permalink to this headline"></a></h4>
<p>Test description should clearly state what the test is testing. Generally, follow the format <code class="docutils literal notranslate"><span class="pre">should</span> <span class="pre">do</span> <span class="pre">X</span> <span class="pre">if</span> <span class="pre">Y</span> <span class="pre">happens</span></code>. For example:</p>
<ul class="simple">
<li><p><strong>Good test name</strong> - ‘it should not return indentation level greater than MAX_INDENTATION_LEVEL’</p></li>
<li><p><strong>Bad test name</strong> - ‘it should return indentation levels’</p></li>
</ul>
<p>Also, write the test descriptions in a way such that they reflect the user’s perspective rather than including implementation details.</p>
</section>
<section id="check-return-values-from-the-code-being-tested">
<h4>Check return values from the code being tested<a class="headerlink" href="#check-return-values-from-the-code-being-tested" title="Permalink to this headline"></a></h4>
<p>Do not just call the code being tested; check that the thing returned is correct. (<a class="reference external" href="https://github.com/oppia/oppia/blob/3fa63711440b4320350c48dd63ffd8b163d07143/core/templates/components/graph-services/graph-layout.service.spec.ts#L528">example</a>)</p>
</section>
<section id="test-the-interface-not-the-implementation">
<h4>Test the interface, not the implementation<a class="headerlink" href="#test-the-interface-not-the-implementation" title="Permalink to this headline"></a></h4>
<p>See <a class="reference external" href="https://eng.libretexts.org/Bookshelves/Computer_Science/Book%3A_Object-Oriented_Reengineering_Patterns_(Demeyer_Ducasse_and_Nierstrasz)/06%3A_Tests__Your_Life_Insurance/6.05%3A_Test_the_Interface_Not_the_Implementation">this link</a> for a rough outline of the concept. If the code that’s being tested changes, but the interface remains stable, your tests should still continue to pass.</p>
<ul>
<li><p>Here, “interface” does not refer to the user interface. It refers to the part of the directive/service/component that can be accessed externally through public functions. So, services have an interface too (i.e. the public functions that they expose to other components/services). You basically want to check whether inputs to those functions result in the correct output.</p></li>
<li><p>Where possible, try to check the inputs and the outputs of the code being tested rather than just whether a particular method has been called. That’s because the latter tends to be directly testing a specific implementation. The exception is when the method being called is a <strong>requirement</strong> of the test, e.g. if we need to verify that a third-party API which we treat as a black box is called — but that’s fairly rare.</p>
<ul>
<li><p><strong>Example</strong>: To test that all the subscriptions in a component have been unsubscribed successfully, you can check the .closed flag which indicates whether the subscription has already been unsubscribed:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should unsubscribe when component is destroyed&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">directiveSubscriptions</span><span class="p">,</span> <span class="s1">&#39;unsubscribe&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">callThrough</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">directiveSubscriptions</span><span class="p">.</span><span class="nx">closed</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$onDestroy</span><span class="p">();</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">directiveSubscriptions</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">directiveSubscriptions</span><span class="p">.</span><span class="nx">closed</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="keep-tests-clean-and-clear">
<h4>Keep tests clean and clear<a class="headerlink" href="#keep-tests-clean-and-clear" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>Keep the body of the test clean and clear. Having too many big blocks of data obscures what we are trying to check. In a case where big blocks of data are necessary to test the code, add comments to explain (as <a class="reference external" href="https://github.com/oppia/oppia/blob/3fa63711440b4320350c48dd63ffd8b163d07143/core/templates/components/graph-services/graph-layout.service.spec.ts#L772-L784">here</a>).</p></li>
<li><p>Do not include unnecessary data in the test.</p>
<ul>
<li><p><strong>Example</strong> : if you are testing that the X property of a dict is modified by a function, then only check the X property. Do not include other properties in the expected variable.</p></li>
</ul>
</li>
<li><p>Leave comments to explain the steps in the test whenever things get complicated. This helps the reader understand what your test does. Ideally, a reader should be able to understand the tests without reading the code file.</p></li>
<li><p>Add visual explanations if possible (<a class="reference external" href="https://github.com/oppia/oppia/blob/1013c9a33af0179ad394088c08ef18ed2f03bd64/core/templates/components/graph-services/graph-layout.service.spec.ts#L28-L57">example</a>).</p></li>
<li><p>For all hardcoded values, explain where the values come from in comments.</p></li>
<li><p>Write the expectations in order, so that each test has a coherent story. That makes the test easier to follow.</p></li>
</ul>
</section>
<section id="similar-tests-should-have-similar-checks">
<h4>Similar tests should have similar checks<a class="headerlink" href="#similar-tests-should-have-similar-checks" title="Permalink to this headline"></a></h4>
<p>For example, if in a test you check that a spy was called when a certain condition was satisfied, then also check that the spy was not called when that condition was not satisfied.</p>
</section>
<section id="validate-external-side-effects">
<h4>Validate external side-effects<a class="headerlink" href="#validate-external-side-effects" title="Permalink to this headline"></a></h4>
<p>An external side-effect is an effect that we expect from running the function but that isn’t part of the outputs. For example, consider this pseudocode:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>function login(username, password) {
  valid = whether the username and password are valid
  if valid {
    setLoginCookie(username)
    return True
  }
  return False
}
</pre></div>
</div>
<p>Here, the call to <code class="docutils literal notranslate"><span class="pre">setLoginCookie()</span></code> is an external side-effect. In our unit tests, it’s not enough to check that the function’s return value is correct; we also need to check that <code class="docutils literal notranslate"><span class="pre">setLoginCookie()</span></code> is called (and not called) correctly.</p>
</section>
</section>
</section>
<section id="general-tips">
<h2>General tips<a class="headerlink" href="#general-tips" title="Permalink to this headline"></a></h2>
<section id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline"></a></h3>
<p>See our <a class="reference internal" href="Debug-frontend-tests.html"><span class="doc std std-doc">guide to debugging frontend tests</span></a> for debugging tips.</p>
</section>
<section id="spy-utilities">
<h3>Spy utilities<a class="headerlink" href="#spy-utilities" title="Permalink to this headline"></a></h3>
<p>One of the main features of Jasmine is allowing you to spy on a method or property of an object. This is helpful in some cases for seeing what is going on:</p>
<ul class="simple">
<li><p>You can spy on an object’s properties (using the <code class="docutils literal notranslate"><span class="pre">spyOnProperty</span></code> method). <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/contextual/device-info.service.spec.ts#L48-L55">Here</a>’s an example.</p></li>
<li><p>You can mock a property value or a method return. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/feedback-tab/services/thread-data.service.spec.ts#L147">Here</a>’s an example.</p></li>
<li><p>You can provide fake implementations that will be called when a method is executed. This is commonly used when mocking AngularJS promises with <code class="docutils literal notranslate"><span class="pre">$defer</span></code>. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/email-dashboard-pages/email-dashboard-page.controller.spec.ts#L121-L133">Here</a>’s an example.</p></li>
<li><p>You can spy on a method to check whether that method is being called when the spec runs. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/schema-default-value.service.spec.ts#L109-L118">Here</a>’s an example.</p></li>
</ul>
<section id="spying-on-third-party-libraries">
<h4>Spying on third-party libraries<a class="headerlink" href="#spying-on-third-party-libraries" title="Permalink to this headline"></a></h4>
<p>Also, the spy can be used when mocking third-party libraries, like JQuery, mostly when doing ajax calls. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/assets-backend-api.service.spec.ts#L274-L292">Here</a>’s a good example when mocking JQuery ajax calls.</p>
</section>
<section id="spying-on-the-same-method-property-more-than-one-time-in-the-same-scope">
<h4>Spying on the same method/property more than one time in the same scope<a class="headerlink" href="#spying-on-the-same-method-property-more-than-one-time-in-the-same-scope" title="Permalink to this headline"></a></h4>
<p>It is impossible to spy twice on the same method or property in the same <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Glossary/Scope">scope</a>. For instance, the code below would throw an error:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">spyOn</span><span class="p">(</span><span class="s1">&#39;should throw an error when spying twice&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">stub</span><span class="p">();</span>
  <span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">stub</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>However, there are some situations where you need to change a value or a method’s return value spy in the same spec, for instance by changing the location path in a mock <code class="docutils literal notranslate"><span class="pre">window</span></code> object, or even reseting a mock to call the original code. You can do it by assigning the spy (without calling any method) to a variable. Then you can use this variable to call the spy methods as many times you want. For example, this code won’t throw an error:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">spyOn</span><span class="p">(</span><span class="s1">&#39;should not throw an error when spying twice&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">warnSpy</span> <span class="o">=</span> <span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
  <span class="nx">warnSpy</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">stub</span><span class="p">();</span>
  <span class="nx">warnSpy</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">stub</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can check real examples of this approach <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/landing-pages/topic-landing-page/topic-landing-page.controller.spec.ts#L94-L109">here</a> (dealing with window location properties) and <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/about-page/about-page.controller.spec.ts#L72-L89">here</a> (resetting spy to original code).</p>
</section>
<section id="spies-that-change-global-values">
<h4>Spies that change global values<a class="headerlink" href="#spies-that-change-global-values" title="Permalink to this headline"></a></h4>
<p>You must not use spies that are declared by reassigning a <strong>global expression</strong>, like the window object or its properties and methods.</p>
<p>Let’s suppose you need to return a custom value from <code class="docutils literal notranslate"><span class="pre">document.getElementById</span></code> but you’re facing some problems trying to do it. You may find nice solutions searching over the internet; however, make sure the chosen solution is not changing a global value, like in this <a class="reference external" href="https://github.com/oppia/oppia/blob/bc8625cb38aef8f93844954d0b0cb797e1bd753b/core/templates/pages/preferences-page/modal-templates/edit-profile-picture-modal.controller.spec.ts#L51-L52">case</a>. You should find another approach for the goal, like this <a class="reference external" href="https://github.com/oppia/oppia/blob/1f20eda67be9bfb78b5885916ce37ddea7f05183/core/templates/pages/preferences-page/modal-templates/edit-profile-picture-modal.controller.spec.ts#L49-L50">example</a>.</p>
<p>The problem with the first case is that changing a global value will affect other files that use the expression you’ve reassigned, making the unit tests error-prone. <a class="reference external" href="https://github.com/oppia/oppia/issues/9660">Here</a>’s a good example of a bug that appears after using the first case.</p>
</section>
<section id="handling-window-events-and-reloads">
<h4>Handling window events and reloads<a class="headerlink" href="#handling-window-events-and-reloads" title="Permalink to this headline"></a></h4>
<p>Spying on the window object is very common because some native behaviors can cause the tests to fail or make them unpredictable. This happens in two specific cases:</p>
<section id="when-window-calls-reload">
<h5>When window calls reload<a class="headerlink" href="#when-window-calls-reload" title="Permalink to this headline"></a></h5>
<p>When reload is called in its native form, it will fail the tests. You can fix this by using the Spy <code class="docutils literal notranslate"><span class="pre">returnValue()</span></code> method. Check it out how to mock <code class="docutils literal notranslate"><span class="pre">reload()</span></code> correctly <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/about-page/about-page.controller.spec.ts#L72-L77">here</a>.</p>
</section>
<section id="using-the-same-object-reference-in-both-file-and-spec-file">
<h5>Using the same object reference in both file and spec file<a class="headerlink" href="#using-the-same-object-reference-in-both-file-and-spec-file" title="Permalink to this headline"></a></h5>
<p>In some cases, you might need to share the same window object in the file you’re testing and in the spec file itself, mainly if you’re working on window events. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/about-page/about-page.controller.spec.ts#L24-L29">Here</a>’s an example of how to do it.</p>
</section>
</section>
</section>
<section id="handling-dates">
<h3>Handling dates<a class="headerlink" href="#handling-dates" title="Permalink to this headline"></a></h3>
<p>As Oppia is a worldwide project, testing date methods turns to be very tricky. For example, if you want to get a date from unix time, you can get different dates depending on the timezone of where you live, making the tests unstable. To avoid errors when testing any date method that can change its value depending on timezone, you should mock it to return a fixed date. Check this <a class="reference external" href="https://github.com/oppia/oppia/blob/7aa80c49f81270c886818e3dce587715dcebac68/core/templates/pages/exploration-editor-page/feedback-tab/thread-table/thread-table.component.spec.ts#L52-L59">example</a>.</p>
</section>
<section id="handling-asynchronous-code">
<h3>Handling asynchronous code<a class="headerlink" href="#handling-asynchronous-code" title="Permalink to this headline"></a></h3>
<section id="making-http-calls">
<h4>Making HTTP calls<a class="headerlink" href="#making-http-calls" title="Permalink to this headline"></a></h4>
<p>All HTTP calls must be mocked since the frontend tests actually run without a backend available. Similarly, any services can also be mocked. We try to keep the usage of such mocks as low as possible since the more mocks there are, the more divergence can arise between the mocks and the underlying code being mocked.</p>
<section id="setting-up-csrftoken">
<h5>Setting up CsrfToken<a class="headerlink" href="#setting-up-csrftoken" title="Permalink to this headline"></a></h5>
<p>In order to make HTTP calls in a secure way, it’s common that applications have tokens to authenticate the user while they are using the platform. In the codebase, there is a specific service to handle the token, called CsrfTokenService. When mocking HTTP calls, you must mock this service in the test file so the tests won’t fail due to lacking a token. Then, you should just copy and paste this piece of code inside a <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> block (the CsrfService will be a variable with the return of <code class="docutils literal notranslate"><span class="pre">$injector.get('CsrfTokenService')</span></code> – in AngularJS – or <code class="docutils literal notranslate"><span class="pre">TestBed.get(CsrfTokenService)</span></code> – in Angular 2+):</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">spyOn</span><span class="p">(</span><span class="nx">CsrfService</span><span class="p">,</span> <span class="s1">&#39;getTokenAsync&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">callFake</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
  <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;sample-csrf-token&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="http-calls-in-angularjs">
<h5>HTTP calls in AngularJS<a class="headerlink" href="#http-calls-in-angularjs" title="Permalink to this headline"></a></h5>
<p><a class="reference external" href="https://github.com/oppia/oppia/blob/ae649aa08f1375457ec9e3c90257197b68fec7cd/core/templates/domain/learner_dashboard/learner-playlist.service.spec.ts#L84-L99">Here</a> is an example which uses <code class="docutils literal notranslate"><span class="pre">$httpBackend</span></code> to mock the backend responses.</p>
<p>To mock a backend call, you need to use the <code class="docutils literal notranslate"><span class="pre">$httpBackend</span></code> dependency. There are two ways to expect an HTTP method (you can use both):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$httpBackend.expectMETHODNAME(URL)</span></code> - like <code class="docutils literal notranslate"><span class="pre">expectPOST</span></code> or <code class="docutils literal notranslate"><span class="pre">expectGET</span></code> for instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$httpBackend.expect(‘METHOD’,</span> <span class="pre">URL)</span></code> - You pass the HTTP method as the first argument.</p></li>
</ul>
<p>When writing HTTP tests (which are asynchronous) we need to always use the <code class="docutils literal notranslate"><span class="pre">$httpBackend.flush()</span></code> method. This will ensure that the mocked request call will be executed.</p>
</section>
<section id="http-calls-in-angular-2">
<h5>HTTP calls in Angular 2+<a class="headerlink" href="#http-calls-in-angular-2" title="Permalink to this headline"></a></h5>
<p>When writing HTTP tests on Angular 2+, use <code class="docutils literal notranslate"><span class="pre">httpTestingController</span></code> with <code class="docutils literal notranslate"><span class="pre">fakeAsync()</span></code> and <code class="docutils literal notranslate"><span class="pre">flushMicrotasks()</span></code>. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/domain/classroom/classroom-backend-api.service.spec.ts#L77-L96">Here</a>’s a good example to follow.</p>
<p>Just like the AngularJS way to mock HTTP calls, the Angular 2+ has flush functions to return the expected response and execute the mock correctly.</p>
</section>
</section>
<section id="using-done-and-done-fail-from-jasmine">
<h4>Using <code class="docutils literal notranslate"><span class="pre">done</span></code> and <code class="docutils literal notranslate"><span class="pre">done.fail</span></code> from Jasmine<a class="headerlink" href="#using-done-and-done-fail-from-jasmine" title="Permalink to this headline"></a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">done</span></code> and <code class="docutils literal notranslate"><span class="pre">done.fail</span></code> is another way to test asynchronous code in Jasmine. You can use it on promises (HTTP calls and so on) and timers such as <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>.</p>
<p>There’s a specific case where you should use <code class="docutils literal notranslate"><span class="pre">done</span></code> on mocking HTTP calls: when you want to assert the result of the fulfilled or rejected promise, as you can see <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/assets-backend-api.service.spec.ts#L274-L292">here</a>. In this piece of code, we need to assert the response variable, and then we call <code class="docutils literal notranslate"><span class="pre">done</span></code> after doing the assertion so Jasmine understands the asynchronous code has been completed. You can use <code class="docutils literal notranslate"><span class="pre">done.fail</span></code> when handling rejected promises.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">done</span></code> when using <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> for specific cases as well, check out this <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/teach-page/teach-page.controller.spec.ts#L53-L67">example</a>.</p>
</section>
<section id="handling-timeout-correctly">
<h4>Handling <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> correctly<a class="headerlink" href="#handling-timeout-correctly" title="Permalink to this headline"></a></h4>
<p>We use <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> a lot across the codebase. When testing a <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> callback, we used to call another <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> in the unit tests, in order to wait for the original callback to be called. However, this approach was tricky and it was making the tests fail. When testing <code class="docutils literal notranslate"><span class="pre">$timeout</span></code> behavior, you should use [<span class="math notranslate nohighlight">\(flushPendingTasks](https://docs.angularjs.org/api/ngMock/service/\)</span>flushPendingTasks), which is cleaner and less error-prone than <code class="docutils literal notranslate"><span class="pre">$timeout</span></code>. Here’s an example:</p>
<p><strong>Bad code:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should wait for 10 seconds to call console.log&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">);</span>
  <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
  <span class="p">},</span> <span class="mf">10</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><strong>Good code:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should wait for 10 seconds to call console.log&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">spyOn</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">);</span>
  <span class="nx">$flushPendingTasks</span><span class="p">();</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="mocking-with-q-api-in-angularjs">
<h4>Mocking with <code class="docutils literal notranslate"><span class="pre">$q</span></code> API in AngularJS<a class="headerlink" href="#mocking-with-q-api-in-angularjs" title="Permalink to this headline"></a></h4>
<p>When mocking a promise in AngularJS, you might use the <code class="docutils literal notranslate"><span class="pre">$q</span></code> API. In these cases, you must use <code class="docutils literal notranslate"><span class="pre">$scope.$apply()</span></code> or <code class="docutils literal notranslate"><span class="pre">$scope.$digest</span></code> because they force <code class="docutils literal notranslate"><span class="pre">$q</span></code> promises to be resolved through a Javascript digest. Here are some examples using <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/services/exploration-states.service.spec.ts#L209-L221"><span class="math notranslate nohighlight">\(apply](https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/email-dashboard-pages/email-dashboard-page.controller.spec.ts#L101-L108) and [\)</span>digest</a>.</p>
</section>
</section>
<section id="when-upgraded-services-should-be-imported-in-the-test-file">
<h3>When upgraded services should be imported in the test file<a class="headerlink" href="#when-upgraded-services-should-be-imported-in-the-test-file" title="Permalink to this headline"></a></h3>
<p>One of the active projects in Oppia is the Angular2+ migration. When testing AngularJS files which rely on an Angular2+ dependency, you must use a <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> call below to import the service. For example, assume that the test requires MyExampleService which is an Angular2+ service.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">TestBed</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core/testing&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MyExampleService</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;services/my-example.service&#39;</span><span class="p">;</span>
<span class="p">...</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
    <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">HttpClientTestingModule</span><span class="p">]</span>
  <span class="p">});</span>
<span class="p">});</span>
<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;oppia&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;MyExampleService&#39;</span><span class="p">,</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">MyExampleService</span><span class="p">));</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>If the file you’re testing doesn’t use any upgraded files, you don’t need to use this <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> call.</p>
</section>
<section id="beforeeach-calls-in-angularjs">
<h3><code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> calls in AngularJS<a class="headerlink" href="#beforeeach-calls-in-angularjs" title="Permalink to this headline"></a></h3>
<p>If you’re testing an AngularJS file that uses an upgraded service, you’ll need to include a <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> block which mocks all the upgraded services. <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/editor-tab/training-panel/training-modal.controller.spec.ts#L35-L48">Here</a> is an example.</p>
<p>However, you might face the following situation: you need to mock an Angular2+ service by using <code class="docutils literal notranslate"><span class="pre">$provide.value</span></code>. Here’s the problem: if you use <code class="docutils literal notranslate"><span class="pre">$provide.value</span></code> before calling the updated services, your mock will be overwritten by the original code of the service. So, you need to change the order of <code class="docutils literal notranslate"><span class="pre">beforeEach</span></code> calls, as you can see in <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/improvements-tab/services/improvement-suggestion-thread-modal.controller.spec.ts#L36-L51">this test</a>.</p>
</section>
<section id="how-to-handle-common-errors">
<h3>How to handle common errors<a class="headerlink" href="#how-to-handle-common-errors" title="Permalink to this headline"></a></h3>
<ul>
<li><p>If you see an error like <code class="docutils literal notranslate"><span class="pre">Error:</span> <span class="pre">Trying</span> <span class="pre">to</span> <span class="pre">get</span> <span class="pre">the</span> <span class="pre">Angular</span> <span class="pre">injector</span> <span class="pre">before</span> <span class="pre">bootstrapping</span> <span class="pre">the</span> <span class="pre">corresponding</span> <span class="pre">Angular</span> <span class="pre">module</span></code>, it means you are using a service (directly or indirectly) that is upgraded to Angular.</p>
<ul>
<li><p>Your test that is written in AngularJS is unable to get that particular service. You can fix this by providing the value of the Angular2+ service using $provide. For example, let us assume that the test requires MyExampleService which is an Angular2+ service. Then you can provide the service like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">TestBed</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core/testing&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MyExampleService</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;services/my-example.service&#39;</span><span class="p">;</span>
<span class="p">...</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
    <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">HttpClientTestingModule</span><span class="p">]</span>
  <span class="p">});</span>
<span class="p">});</span>
<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;oppia&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;MyExampleService&#39;</span><span class="p">,</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">MyExampleService</span><span class="p">));</span>
<span class="p">}));</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>If you’re working with async on AngularJS and your tests don’t seem to run correctly, make sure you’re using <code class="docutils literal notranslate"><span class="pre">$apply</span></code> or <code class="docutils literal notranslate"><span class="pre">$digest</span></code> in the spec, as in this <a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/topic-editor-page/services/topic-editor-state.service.spec.ts#L716-L720">example</a>.</p></li>
</ul>
</section>
</section>
<section id="testing-services">
<h2>Testing services<a class="headerlink" href="#testing-services" title="Permalink to this headline"></a></h2>
<p>Services are one of the most important features in the codebase. They contain logic that can be used across the codebase multiple times. There are three possible extensions for services:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*.service.ts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*Factory.ts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.factory.ts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.tokenizer.ts</span></code></p></li>
</ul>
<p>As a good first issue, all the services that need to be tested are listed in <a class="reference external" href="https://github.com/oppia/oppia/issues/4057">issue #4057</a>.</p>
<section id="testing-angularjs-services">
<h3>Testing AngularJS services<a class="headerlink" href="#testing-angularjs-services" title="Permalink to this headline"></a></h3>
<p>Use these files that are correctly following the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-player-page/services/current-interaction.service.spec.ts#L39">current-interaction.service.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/domain/exploration/editable-exploration-backend-api.service.spec.ts#L30">editable-exploration-backend-api.service.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/improvement-task.service.spec.ts#L29">improvement-task.service.spec.ts</a></p></li>
</ul>
</section>
<section id="testing-angular-2-services">
<h3>Testing Angular 2+ services<a class="headerlink" href="#testing-angular-2-services" title="Permalink to this headline"></a></h3>
<p>Use these files that are correctly following the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/exploration-features-backend-api.service.spec.ts#L26">exploration-features-backend-api.service.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/editability.service.spec.ts#L21">editability.service.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/services/exploration-html-formatter.service.spec.ts#L27">exploration-html-formatter.service.spec.ts</a></p></li>
</ul>
</section>
</section>
<section id="testing-controllers">
<h2>Testing controllers<a class="headerlink" href="#testing-controllers" title="Permalink to this headline"></a></h2>
<p>Controllers are used often for AngularJS UI Bootstrap library’s modals. Here are some files that are correctly being tested and follow the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/aa288fd246dec2f8a30a1e9f72a77bd97952c132/core/templates/pages/exploration-editor-page/modal-templates/welcome-modal.controller.spec.ts">welcome-modal.controller.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/3642a4c21e387493f85c7bb72fe1789d214ffffb/core/templates/components/skill-selector/merge-skill-modal.controller.spec.ts">merge-skill-modal.controller.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/125e4388c665c86cb932dc2391093fa6946a5a83/core/templates/pages/skill-editor-page/editor-tab/skill-preview-modal.controller.spec.ts">skill-preview-modal.controller.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/exploration-editor-page/improvements-tab/services/improvement-confirmation-modal.controller.spec.ts#L19">improvement-confirmation-modal.controller.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/2e60d69d7b/core/templates/pages/landing-pages/stewards-landing-page/stewards-landing-page.controller.spec.ts#L25">stewards-landing-page.controller.spec.ts</a></p></li>
</ul>
<p><strong>Note:</strong> If you intend to create a new modal using <code class="docutils literal notranslate"><span class="pre">$uibModal.open</span></code> method, please be sure to create its controller in a separate file. See <a class="reference external" href="https://github.com/oppia/oppia/issues/8924">issue #8924</a> for more information.</p>
<p>Also, there are controllers that are not linked to modals. Here is an example:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/04570fb22780d9a22d94e33916a1d0e8d17c2a6d/extensions/interactions/LogicProof/static/js/tools/logic-demo-test.controller.spec.ts">logic-demo-test.controller.spec.ts</a></p></li>
</ul>
</section>
<section id="testing-directives-and-components">
<h2>Testing directives and components<a class="headerlink" href="#testing-directives-and-components" title="Permalink to this headline"></a></h2>
<section id="testing-angularjs-directives-and-components">
<h3>Testing AngularJS directives and components<a class="headerlink" href="#testing-angularjs-directives-and-components" title="Permalink to this headline"></a></h3>
<p><strong>Note</strong> If you’re creating a new AngularJS directive, please make sure the value of the restrict <code class="docutils literal notranslate"><span class="pre">property</span></code> is not <code class="docutils literal notranslate"><span class="pre">E</span></code>. If it’s an <code class="docutils literal notranslate"><span class="pre">E</span></code>, change the directive to an AngularJS component. You can check out <a class="reference external" href="https://github.com/oppia/oppia/pull/9850">this PR</a> to learn how to properly make the changes.</p>
<p>Use these AngularJS component files that are correctly following the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/a9bece78fd45344f5e0e741ab21f8ea0c289a923/core/templates/pages/library-page/search-bar/search-bar.component.spec.ts">search-bar.component.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/3642a4c21e387493f85c7bb72fe1789d214ffffb/core/templates/pages/preferences-page/preferences-page.component.spec.ts">preferences-page.component.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/fcb44f8cc6e0e00aaa082045cf8b363daa510479/core/templates/pages/topic-viewer-page/practice-tab/practice-tab.component.spec.ts">practice-tab.component.spec.ts</a></p></li>
</ul>
<p>Use these AngularJS directive files that are correctly following the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/7aa80c49f81270c886818e3dce587715dcebac68/core/templates/pages/exploration-editor-page/param-changes-editor/value-generator-editor.directive.spec.ts">value-generator-editor.directive.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/4ec7b9cc70e2a255653952450fe44932607755af/core/templates/pages/exploration-editor-page/translation-tab/audio-translation-bar/audio-translation-bar.directive.spec.ts">audio-translation-bar.directive.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/89a809b521af0c2d21b71db5cdc8c644d893a577/extensions/visualizations/oppia-visualization-click-hexbins.directive.spec.ts">oppia-visualization-click-hexbins.directive.spec.ts</a></p></li>
</ul>
</section>
<section id="testing-angular2-directives-and-components">
<h3>Testing Angular2+ directives and components<a class="headerlink" href="#testing-angular2-directives-and-components" title="Permalink to this headline"></a></h3>
<p>Let us assume that we are writing tests for an Angular2+ component called BannerComponent. The first thing to do is to import all dependencies, we have a boilerplate for that:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span> <span class="k">async</span><span class="p">,</span> <span class="nx">ComponentFixture</span><span class="p">,</span> <span class="nx">TestBed</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@angular/core/testing&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BannerComponent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./banner.component&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;BannerComponent&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">component</span><span class="o">:</span> <span class="nx">BannerComponent</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">fixture</span><span class="o">:</span> <span class="nx">ComponentFixture</span><span class="o">&lt;</span><span class="nx">BannerComponent</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">TestBed</span><span class="p">.</span><span class="nx">configureTestingModule</span><span class="p">({</span>
      <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span> <span class="nx">BannerComponent</span> <span class="p">]</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">compileComponents</span><span class="p">();</span>
  <span class="p">}));</span>

  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">fixture</span> <span class="o">=</span> <span class="nx">TestBed</span><span class="p">.</span><span class="nx">createComponent</span><span class="p">(</span><span class="nx">BannerComponent</span><span class="p">);</span>
    <span class="nx">component</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">.</span><span class="nx">componentInstance</span><span class="p">;</span>
    <span class="nx">fixture</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should create&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">component</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Once this is done, you have the class instance in the variable called <code class="docutils literal notranslate"><span class="pre">component</span></code> and you can continue writing the tests as a class testing.</p>
<p>At the moment, we don’t enforce <a class="reference external" href="https://angular.io/guide/testing-components-basics#component-dom-testing">DOM testing</a>. However, as the docs say, the component is not fully tested until we test the DOM too. Eventually we hope to add DOM tests for all our components, however, for now if you are making a PR fixing a bug caused due to incorrect DOM bindings, then add DOM tests for that component. Our coverage checks do not require DOM tests.</p>
<p>Use these Angular2+ component files that are correctly following the testing patterns for reference:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/327df0c22ec839d4ad4232492749c78443b15fb0/core/templates/pages/donate-page/donate-page.component.spec.ts">donate-page.component.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/13b1da20ee6c0e4eabc9720a3d1ca3d87c62fe8c/core/templates/pages/teach-page/teach-page.component.spec.ts">teach-page.component.spec.ts</a></p></li>
<li><p><a class="reference external" href="https://github.com/oppia/oppia/blob/b46dd92fdb40e51ce8a9b66c507acd23a55a69d5/core/templates/pages/about-page/about-page.component.spec.ts">about-page.component.spec.ts</a></p></li>
</ul>
</section>
</section>
<section id="contacts">
<h2>Contacts<a class="headerlink" href="#contacts" title="Permalink to this headline"></a></h2>
<p>If you have any questions about the above, you can contact any of the people below:</p>
<ul class="simple">
<li><p>&#64;aishwary023 - aishwary.saxena.min19&#64;iitbhu.ac.in</p></li>
<li><p>&#64;gp201 - praneethg2001&#64;gmail.com</p></li>
<li><p>&#64;Radesh-kumar - imradesh&#64;gmail.com</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Backend-tests.html" class="btn btn-neutral float-left" title="Backend tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="End-to-End-Tests.html" class="btn btn-neutral float-right" title="End to end tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The Oppia Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>